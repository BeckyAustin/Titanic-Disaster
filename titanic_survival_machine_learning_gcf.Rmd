---
title: "Titanic survival machine learning analysis"
author: Graham French
date: '`r Sys.Date()`'
output: html_notebook
---

```{r }
library(magrittr)
```

The titanic package contains both the training and test data

```{r}
train <- titanic::titanic_train
test <- titanic::titanic_test
```

A good work through of the analysis is [Trevor Stephen's series of titanic tutorials](http://trevorstephens.com/kaggle-titanic-tutorial/getting-started-with-r/)

## Decision Trees

[Part 3](http://trevorstephens.com/kaggle-titanic-tutorial/r-part-3-decision-trees/) of the tutorial calculates survival using decision trees

```{r fig.width=8}
fit <- rpart::rpart(Survived ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked,
             data = train,
             method = "class") %T>% 
  rattle::fancyRpartPlot()
```

```{r}
prediction <- predict(fit, test, type = "class")
submit <- test %>%
  dplyr::mutate(Survived = prediction) %>% 
  dplyr::select(PassengerId, Survived) %T>% 
  readr::write_csv(here::here("myfirstdtree.csv"))
```

## Random Forest

Random Forest method does not allow for missing values so need to fill predict the gaps in both the test and training datasets

Predict the missing ages using a decision tree

```{r}
# Combine the training and test datasets
combined <- dplyr::bind_rows(train, test)
combined_train <- combined %>% dplyr::filter(!is.na(Age))

# Run decision tree on training dataset with known ages
fit_age <- rpart::rpart(Age ~ Pclass + Sex + SibSp + Parch + Fare + Embarked,
                  data = combined_train, 
                  method = "anova")

# Update missing ages with predicted ages
combined_test <- combined %>% 
  dplyr::filter(is.na(Age)) %>% 
  dplyr::mutate(Age = predict(fit_age, .))

# Recombine training and test datasets
combined <- dplyr::bind_rows(combined_train, combined_test)

# Recreate the titanic training and test datasets
rf_train <- combined %>%
  dplyr::filter(PassengerId <= 891)
rf_test <- combined %>%
  dplyr::filter(PassengerId > 891) %>% 
  dplyr::select(-Survived)
```

Fill in missing Embarked values by assumming they got on in Southampton



